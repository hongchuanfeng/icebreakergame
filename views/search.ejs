<%- include('partials/header', { 
    pageTitle: typeof t !== 'undefined' ? (searchQuery ? t('search.title', { query: searchQuery }) : t('search.title', { query: '' })) : (searchQuery ? `æœç´¢ "${searchQuery}" - Ice Breaker Games` : 'æœç´¢æ¸¸æˆ - Ice Breaker Games'),
    metaDescription: typeof t !== 'undefined' ? (searchQuery ? t('search.description', { query: searchQuery }) : t('search.description', { query: '' })) : (searchQuery ? `æœç´¢"${searchQuery}"ç›¸å…³çš„æ¸¸æˆ - Ice Breaker Games` : 'æœç´¢ä½ å–œæ¬¢çš„æ¸¸æˆ - Ice Breaker Games'),
    metaKeywords: searchQuery + ', ice breaker games, search games',
    canonicalUrl: typeof localeUrl !== 'undefined' ? localeUrl('/search?q=' + encodeURIComponent(searchQuery || '')) : ('https://www.icebreakgame.com/search?q=' + encodeURIComponent(searchQuery || '')),
    searchQuery: searchQuery || ''
}) %>

<!-- ä¸»å†…å®¹åŒº -->
<div class="main-content">
    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    <nav class="sidebar">
        <ul class="nav-menu">
            <% categories.forEach(category => { %>
                <li class="nav-item">
                    <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/#category-' + category.replace(/\s+/g, '-')) : '/#category-' + category.replace(/\s+/g, '-') %>" class="nav-link">
                        <span class="nav-icon"><%= getCategoryIcon(category) %></span>
                        <span><%= category %></span>
                    </a>
                </li>
            <% }); %>
        </ul>
    </nav>

    <!-- å³ä¾§å†…å®¹åŒº -->
    <div class="content-area">
        <% if (searchResults.length > 0) { %>
            <% 
                // æŒ‰åˆ†ç±»åˆ†ç»„
                const groupedResults = {};
                searchResults.forEach(game => {
                    const category = game.category || (typeof t !== 'undefined' ? t('search.uncategorized') : 'æœªåˆ†ç±»');
                    if (!groupedResults[category]) {
                        groupedResults[category] = [];
                    }
                    groupedResults[category].push(game);
                });
            %>
            <% Object.keys(groupedResults).forEach(category => { %>
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title"><%= typeof t !== 'undefined' ? t('search.searchFor', { query: searchQuery }) : ('æœç´¢ "' + searchQuery + '"') %> - <%= category %></h2>
                    </div>
                    <div class="games-grid">
                        <% groupedResults[category].forEach(game => { %>
                            <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/game?categoryId=' + (game.categoryId || '') + '&gameId=' + (game.id || '')) : '/game?categoryId=' + (game.categoryId || '') + '&gameId=' + (game.id || '') %>" 
                               class="game-card">
                                <% if (game.icon) { %>
                                    <img src="<%= game.icon %>" alt="<%= game.name %>" class="game-card-image" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=&quot;game-card-image&quot;>ðŸŽ®</div><div class=&quot;game-card-info&quot;><div class=&quot;game-card-name&quot;><%- game.name %></div></div>'">
                                <% } else { %>
                                    <div class="game-card-image">ðŸŽ®</div>
                                <% } %>
                                <div class="game-card-info">
                                    <div class="game-card-name"><%- game.name %></div>
                                </div>
                            </a>
                        <% }); %>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="category-section">
                <div style="text-align: center; color: rgba(255, 255, 255, 0.7); padding: 3rem;">
                    <h2 style="margin-bottom: 1rem;"><%= typeof t !== 'undefined' ? t('search.noResults') : 'æœªæ‰¾åˆ°ç›¸å…³æ¸¸æˆ' %></h2>
                    <p><%= typeof t !== 'undefined' ? t('search.tryOtherKeywords') : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯ï¼Œæˆ–' %><a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/') : '/' %>" style="color: rgba(102, 126, 234, 0.8); text-decoration: underline;"><%= typeof t !== 'undefined' ? t('common.backToHome') : 'è¿”å›žé¦–é¡µ' %></a></p>
                </div>
            </div>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>

