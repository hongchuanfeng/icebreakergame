<%- include('partials/header', { 
    pageTitle: typeof t !== 'undefined' ? t('category.title', { categoryName: category }) : (category + ' - Ice Breaker Games'),
    metaDescription: typeof t !== 'undefined' ? t('category.description', { categoryName: category, totalGames: totalGames }) : ('æµè§ˆ ' + category + ' åˆ†ç±»ä¸‹çš„æ‰€æœ‰æ¸¸æˆï¼Œå…è´¹åœ¨çº¿HTML5æ¸¸æˆå¹³å°'),
    metaKeywords: categoryKeywords || (category + ', ice breaker games'),
    canonicalUrl: typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(category) + (searchQuery ? '?q=' + encodeURIComponent(searchQuery) : '')) : ('https://www.icebreakgame.com/category/' + encodeURIComponent(category) + (searchQuery ? '?q=' + encodeURIComponent(searchQuery) : '')),
    searchQuery: searchQuery || ''
}) %>

<!-- ä¸»å†…å®¹åŒº -->
<div class="main-content">
    <!-- å†…å®¹åŒºï¼ˆå…¨å®½æ˜¾ç¤ºï¼‰ -->
    <div class="content-area" style="width: 100%;">
        <div class="category-section">
            <div class="category-header">
                <div style="flex: 1;">
                    <h2 class="category-title"><%= category %></h2>
                    <div style="margin-top: 0.5rem; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                        <% if (searchQuery) { %>
                            <%= typeof t !== 'undefined' ? t('category.searchFound', { query: searchQuery, count: totalGames }) : ('æœç´¢ "' + searchQuery + '" æ‰¾åˆ° ' + totalGames + ' æ¬¾æ¸¸æˆ') %>
                        <% } else { %>
                            <%= typeof t !== 'undefined' ? t('category.gamesFound', { count: totalGames }) : ('å…± ' + totalGames + ' æ¬¾æ¸¸æˆ') %>
                        <% } %>
                        <% if (totalPages > 1) { %>
                            <%= typeof t !== 'undefined' ? t('category.pageInfo', { current: currentPage, total: totalPages }) : ('ï¼ˆç¬¬ ' + currentPage + ' / ' + totalPages + ' é¡µï¼‰') %>
                        <% } %>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <!-- åˆ†ç±»æœç´¢æ¡† -->
                    <div class="category-search-box" style="position: relative; min-width: 250px; flex: 1;">
                        <form method="GET" action="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category)) : '/category/' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category) %>" style="position: relative;">
                            <input type="text" name="q" class="category-search-input" placeholder="ðŸ” <%= typeof t !== 'undefined' ? t('category.searchPlaceholder') : 'åœ¨æœ¬åˆ†ç±»ä¸­æœç´¢...' %>" value="<%= searchQuery || '' %>" style="width: 100%; padding: 12px 50px 12px 16px; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 12px; font-size: 14px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); color: #ffffff; transition: all 0.3s ease;">
                            <button type="submit" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 8px 20px; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: 600;"><%= typeof t !== 'undefined' ? t('category.searchButton') : 'æœç´¢' %></button>
                        </form>
                        <% if (searchQuery) { %>
                            <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category)) : '/category/' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category) %>" style="display: block; margin-top: 0.5rem; color: rgba(255, 255, 255, 0.7); text-decoration: none; font-size: 0.85rem; text-align: right;"><%= typeof t !== 'undefined' ? t('category.clearSearch') : 'æ¸…é™¤æœç´¢' %></a>
                        <% } %>
                    </div>
                    <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/') : '/' %>" class="more-btn"><%= typeof t !== 'undefined' ? t('category.backToHome') : 'è¿”å›žé¦–é¡µ' %></a>
                </div>
            </div>
            
            <% if (games.length > 0) { %>
                <div class="games-grid">
                    <% games.forEach(game => { %>
                        <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/game?name=' + encodeURIComponent(game.name) + '&link=' + encodeURIComponent(game.link || '') + '&href=' + encodeURIComponent(game.href || '') + '&category=' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category)) : '/game?name=' + encodeURIComponent(game.name) + '&link=' + encodeURIComponent(game.link || '') + '&href=' + encodeURIComponent(game.href || '') + '&category=' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category) %>" 
                           class="game-card">
                            <% if (game.icon) { %>
                                <img src="<%= game.icon %>" alt="<%= game.name %>" class="game-card-image" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=&quot;game-card-image&quot;>ðŸŽ®</div><div class=&quot;game-card-info&quot;><div class=&quot;game-card-name&quot;><%- game.name %></div></div>'">
                            <% } else { %>
                                <div class="game-card-image">ðŸŽ®</div>
                            <% } %>
                            <div class="game-card-info">
                                <div class="game-card-name"><%- game.name %></div>
                            </div>
                        </a>
                    <% }); %>
                </div>
                
                <!-- åˆ†é¡µå¯¼èˆª -->
                <% if (totalPages > 1) { %>
                    <div class="pagination-container">
                        <div class="pagination">
                            <% const urlCategory = typeof originalCategory !== 'undefined' ? originalCategory : category; %>
                            <% if (currentPage > 1) { %>
                                <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(urlCategory) + '?page=' + (currentPage - 1) + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '')) : '/category/' + encodeURIComponent(urlCategory) + '?page=' + (currentPage - 1) + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '') %>" class="pagination-btn"><%= typeof t !== 'undefined' ? t('category.previousPage') : 'ä¸Šä¸€é¡µ' %></a>
                            <% } else { %>
                                <span class="pagination-btn disabled"><%= typeof t !== 'undefined' ? t('category.previousPage') : 'ä¸Šä¸€é¡µ' %></span>
                            <% } %>
                            
                            <% 
                                // æ˜¾ç¤ºé¡µç 
                                let startPage = Math.max(1, currentPage - 2);
                                let endPage = Math.min(totalPages, currentPage + 2);
                                
                                if (startPage > 1) { %>
                                    <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(urlCategory) + '?page=1' + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '')) : '/category/' + encodeURIComponent(urlCategory) + '?page=1' + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '') %>" class="pagination-number">1</a>
                                    <% if (startPage > 2) { %>
                                        <span class="pagination-ellipsis">...</span>
                                    <% } %>
                                <% }
                                
                                for (let i = startPage; i <= endPage; i++) { %>
                                    <% if (i === currentPage) { %>
                                        <span class="pagination-number active"><%= i %></span>
                                    <% } else { %>
                                        <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(urlCategory) + '?page=' + i + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '')) : '/category/' + encodeURIComponent(urlCategory) + '?page=' + i + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '') %>" class="pagination-number"><%= i %></a>
                                    <% } %>
                                <% }
                                
                                if (endPage < totalPages) { %>
                                    <% if (endPage < totalPages - 1) { %>
                                        <span class="pagination-ellipsis">...</span>
                                    <% } %>
                                    <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(urlCategory) + '?page=' + totalPages + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '')) : '/category/' + encodeURIComponent(urlCategory) + '?page=' + totalPages + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '') %>" class="pagination-number"><%= totalPages %></a>
                                <% } %>
                            
                            <% if (currentPage < totalPages) { %>
                                <a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(urlCategory) + '?page=' + (currentPage + 1) + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '')) : '/category/' + encodeURIComponent(urlCategory) + '?page=' + (currentPage + 1) + (searchQuery ? '&q=' + encodeURIComponent(searchQuery) : '') %>" class="pagination-btn"><%= typeof t !== 'undefined' ? t('category.nextPage') : 'ä¸‹ä¸€é¡µ' %></a>
                            <% } else { %>
                                <span class="pagination-btn disabled"><%= typeof t !== 'undefined' ? t('category.nextPage') : 'ä¸‹ä¸€é¡µ' %></span>
                            <% } %>
                        </div>
                    </div>
                <% } %>
            <% } else { %>
                <div style="text-align: center; color: rgba(255, 255, 255, 0.7); padding: 3rem;">
                    <h3 style="margin-bottom: 1rem;"><%= typeof t !== 'undefined' ? t('category.noGames') : 'æœªæ‰¾åˆ°ç›¸å…³æ¸¸æˆ' %></h3>
                    <p><%= typeof t !== 'undefined' ? t('category.tryOtherKeywords') : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯ï¼Œæˆ–' %><a href="<%= typeof localeUrl !== 'undefined' ? localeUrl('/category/' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category)) : '/category/' + encodeURIComponent(typeof originalCategory !== 'undefined' ? originalCategory : category) %>" style="color: rgba(102, 126, 234, 0.8); text-decoration: underline;"><%= typeof t !== 'undefined' ? t('category.viewAllGames') : 'æŸ¥çœ‹æ‰€æœ‰æ¸¸æˆ' %></a></p>
                </div>
            <% } %>
        </div>
    </div>
</div>

<%- include('partials/footer') %>
